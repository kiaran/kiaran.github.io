<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Ground Node - Power IK</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Ground Node";
    var mkdocs_page_input_path = "unreal\\ground_node.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Power IK</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../sdk/change_log/">ChangeLog</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Unreal Plugin</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../getting_started_unreal/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../old_versions/">Compiling for Old Unreal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Core Solver</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../solver_setup/">Solver Setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../solver_bones/">Solver Bones</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../bend_directions/">Bend Directions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../limits/">Limits and Stiffness</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../root_rotation/">Root Rotation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../inertia/">Body Inertia</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../center_of_gravity/">Center of Gravity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../bone_translation/">Bone Translation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../solver_performance/">Solver Performance</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Effectors</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../effector_settings/">Effector Settings</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../effector_smoothing/">Effector Smoothing</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Features</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Ground Node</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#video-tutorial">Video Tutorial</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it Works</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-to-setup-grounding">How to Setup Grounding</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#setup-a-ground-node">Setup a Ground Node</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#how-to-choose-a-character-root-bone">How to Choose a Character Root Bone</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#exclude-bones">Exclude Bones</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#optional-delta-smooth-speed">(Optional) Delta Smooth Speed</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#optional-pull-weight-and-pull-factors">(Optional) Pull Weight and Pull Factors</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#setup-a-collision-trace-channel">Setup a Collision Trace Channel</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#now-tune-the-slope-settings">Now Tune the Slope Settings</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#interactive-tuning">Interactive Tuning</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#collision-settings">Collision Settings</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#slope-settings">Slope Settings</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#stride-scaling">Stride Scaling</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#leaning">Leaning</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#counter-leaning">Counter Leaning</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#root-offset">Root Offset</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#foot-rotation">Foot Rotation</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#foot-offset">Foot Offset</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../control_rig/">Control Rig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../walk_node/">Walk Node</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../walk_blueprint/">Walk Blueprint</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../packaging/">Packaging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../common_issues/">Common Issues</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">C++ SDK</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../sdk/getting_started_sdk/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sdk/convert_plugin/">Convert Unreal Plugin</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sdk/solver/">Solver Class</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Settings</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../sdk/settings_solver/">Solver Settings</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../sdk/settings_ground/">Ground Settings</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../sdk/settings_cog/">Center of Gravity Settings</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../sdk/settings_smoothing/">Effector Smoothing Settings</a>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Power IK</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Features &raquo;</li>
        
      
        
          <li>Unreal Plugin &raquo;</li>
        
      
    
    <li>Ground Node</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="grounding">Grounding</h1>
<p>Power IK comes with a dedicated Anim Graph node for contouring your creatures to uneven terrain. </p>
<p><img alt="Ground" src="../img/ground/spider.gif" /></p>
<h2 id="video-tutorial">Video Tutorial</h2>
<p>The easiest way to learn how to use the Ground Node is to <a href="https://youtu.be/g1FgBDIA2zA">see it in action in our video tutorial</a>. The video tutorial demonstrates the process of adding ground alignment to the Unreal 3rd person Mannequin.</p>
<h2 id="how-it-works">How it Works</h2>
<p>The Power IK Ground node uses the Power IK Solver to generate a new pose given updated foot positions that are on the ground.</p>
<p>It helps to understand the basic algorithm for ground alignment:</p>
<pre><code>For each Foot:
    Calculate foot location in world space
    Cast a ray from this location
    If ray hits collider:
        Smoothly move the effector towards hit point
Run solver using new effector locations
</code></pre>

<p>As you can see, because it is based on raycasts, you have to make sure that your collision filtering and level collision is setup to support good ground IK.</p>
<h2 id="how-to-setup-grounding">How to Setup Grounding</h2>
<p>For a complete overview of the setup process for Power IK Ground Alignment, <a href="https://youtu.be/g1FgBDIA2zA">checkout the video tutorial</a>.</p>
<h3 id="setup-a-ground-node">Setup a Ground Node</h3>
<ol>
<li>Create a <em>Power IK Ground</em> node.</li>
<li>Set the name of the Character Root bone on the node.</li>
<li>Select the node and open the Details section.</li>
<li>Add to the <em>Feet</em> list and set <em>Bone Name</em> to the name of the foot bone.</li>
<li>Set the Collision Trace Channel in the Ground Collision settings.</li>
</ol>
<p><img alt="Ground" src="../img/ground/ground_node.png" /></p>
<p>At this point, Power IK will stick the feet to the ground, pulling the whole body if necessary by translating the Character Root bone.</p>
<p>The following settings can be used to tune the Ground alignment behavior. Many of these settings are identical to the Power IK Solver settings (since the Ground node is just a different wrapper around the core solver).</p>
<p><img alt="Ground" src="../img/ground/ground_settings.png" /></p>
<h3 id="how-to-choose-a-character-root-bone">How to Choose a Character Root Bone</h3>
<p>The Character Root bone is the top-most bone in the skeleton that represents the "Center of Gravity" of the body. This is usually located between the legs at the base of the spine.</p>
<p>In the Unreal mannequin, this is called the "Pelvis". It may also be called "Hips", "Body", "COG" or anything else depending on the rig naming convention.</p>
<p>It is crucial that the Character Root bone moves the entire skin when translated. Typically, this is the ONLY bone in the skeleton that does translate. </p>
<p>It's position is also important. For good results, it should be located at the base of the spine and have all leg(s), spine(s) and tail(s) as children of it. Usually the <em>Character</em> root bone is <em>not</em> the same as the actual root bone (the top most bone in the hierarchy). </p>
<p>If you are unsure which bone to use, open the Skeleton editor and follow the foot bone up the hierarchy until you reach the first bone that contains the spine and the legs. Select it and translate it to make sure that it has the desired behavior of moving the whole character from a location near the center of gravity for the creature.</p>
<h2 id="exclude-bones">Exclude Bones</h2>
<p>Some skeletons may have multiple bones at the Character Root level and they may even lie ontop of each other. It is important that no bones between the Character Root and the feet are located directly ontop of each other (in the path of lineage from the feet to the root). If they are, add them to the Excluded Bones list.</p>
<p>Also locate any "twist" or helper bones that are located in the path from the feet up to the Character Root. If the helper bones are <em>between</em> the leg bones, they must be excluded or else Power IK will treat them as an additional leg bone and bend them!</p>
<h3 id="optional-delta-smooth-speed">(Optional) Delta Smooth Speed</h3>
<p>The Ground Node exposes the Delta Smooth Speed of the foot effectors. This value controls how quickly the feet adapt to changing terrain height (measured in cm/s). </p>
<p>If you notice the feet gradually sliding towards the ground height, increase this value until it's no longer noticable. Typically values between 100 and 400 cm/s are suitable for this parameter.</p>
<h3 id="optional-pull-weight-and-pull-factors">(Optional) Pull Weight and Pull Factors</h3>
<p>Setting the Pull Factors in X and Y to zero (the default) prevents the effector from yanking the body around when the feet have to reach up or down a slope. </p>
<p>If you set Z to zero as well, it will prevent the solver from pulling the hips of the character to reach for the ground. This could leave your character floating if the ground is far away from the capsule, though typically this never happens.</p>
<p>For creatures with many limbs (like spiders), it may actually be nice to have the limbs pulling the body. For bipeds though, it is typically best to turn PullWeight off completely and let the slope alignment settings move the hips for you.</p>
<p><strong>Note:</strong> If you notice the hips being yanked around by the feet, try adjusting the PullWeight and Pull Factors.</p>
<h3 id="setup-a-collision-trace-channel">Setup a Collision Trace Channel</h3>
<p>You have to tell PowerIK what surfaces the ground rays should collide with. These settings may be project specific. For default Unreal settings, the following procedure should ensure correct collision filtering for Unreal characters with a capsule:</p>
<ol>
<li>In Unreal go to Edit &gt; Project Settings &gt; Collision</li>
<li>Click New Trace Channel</li>
<li>Name it IKTrace and set <em>Default Response</em> to <em>Block</em></li>
<li>Open the Preset section of the Collision settings.</li>
<li>Double-click <em>Pawn</em> and set IKTrace to <em>Ignore</em> then click Accept.</li>
<li>Set the IKTrace to Ignore <em>Character Mesh</em> presets as well.</li>
<li>Locate and select the Power IK Solver node and open the Details panel </li>
<li>Open the Ground Settings Collision Channel and set it to: <em>IKTrace</em></li>
</ol>
<p><strong>Note:</strong> It may be necessary to also tell the Character capsule to ignore the IKTrace channel</p>
<h3 id="now-tune-the-slope-settings">Now Tune the Slope Settings</h3>
<ol>
<li>Select the solver node and in the details pane find the Ground Slope section.</li>
<li>Tune these settings to achieve the desired ground alignment behavior.</li>
</ol>
<p>See the Ground Slope Settings section for details on what each of these parameters do.</p>
<h3 id="interactive-tuning">Interactive Tuning</h3>
<p>You can adjust the slope settings interactively while playing in editor. Simply open the Animation Blueprint, select your character and adjust the slope settings. You must Compile the animation blueprint between parameter adjustements to see the effect while playing in editor. </p>
<p>It can be useful to place a cube underneath your character that you can rotate freely as you tune slope settings interactively. </p>
<h2 id="collision-settings">Collision Settings</h2>
<p><img alt="Ground Settings" src="../img/ground/ground_collision.png" /></p>
<p>All the Grounding settings are found by selecting the solver node and opening the details panel:</p>
<ul>
<li><strong>Ground Plane Bone</strong>: the name of the bone that represents the “ground plane” in your animation. Typically this is just the root bone, but you can use a separate bone if you want. The height of the effector relative to this plane is always maintained. So if the animation pulls the characters foot 10cm above the ground plane, then the foot will be 10cm above the ray cast hit location.</li>
<li><strong>Collision Channel</strong>: this is the level collision channel that the rays are collided against. Make sure that the level is setup with collision on this channel for the character to collide with.</li>
<li><strong>Trace Complex:</strong> whether to trace against Complex or Simple collision geometry. Complex is usually preferred, though slightly more expensive.</li>
<li><strong>Ray Cast Up</strong>: the distance in centimeters to cast upwards looking for terrain to stand on.</li>
<li><strong>Ray Cast Down</strong>: the distance in centimeters to cast downwards looking for terrain to stand on.</li>
</ul>
<h2 id="slope-settings">Slope Settings</h2>
<p><img alt="Slope Settings" src="../img/ground/ground_slope.png" /></p>
<ul>
<li><strong>Vec3 StrideDirection:</strong> Normalized vector that describes the direction of travel. This vector points in the forward facing direction of your character and usually remains constant.</li>
<li><strong>MaxGroundAngle:</strong> Maximum angle relative to gravity vector to apply leaning and stride scaling.</li>
</ul>
<h3 id="stride-scaling">Stride Scaling</h3>
<p>These settings scale the stride of the foot effectors. Essentially making the character take longer or shorter steps.</p>
<ul>
<li>
<p><strong>ScaleStride bool:</strong> If true, stride of IsGrounded effectors will be scaled in Stride Direction.</p>
</li>
<li>
<p><strong>UphillStrideScale float:</strong> Amount to scale stride when going uphill. Range is 0-1. Default 0.4.</p>
</li>
<li>
<p><strong>DownhillStrideScale float:</strong> Amount to scale stride when going downhill. Range is 0-1. Default 0.2.</p>
</li>
<li>
<p><strong>SidehillStrideScale float:</strong> Amount to scale stride when on a side-hill. Range is 0-1. Default 1.0.</p>
</li>
<li>
<p><strong>SidehillPushOuterFeet float:</strong> Amount (in centimeters) to push outside feet outwards on sidehills. Default is 20.0.</p>
</li>
<li>
<p><strong>SidehillPushInnerFeet float:</strong> Amount (in centimeters) to push inside feet outwards on sidehills. Default is 10.0.</p>
</li>
</ul>
<h3 id="leaning">Leaning</h3>
<p>These settings rotate the spine of the character to lean into or away from a slope.</p>
<ul>
<li>
<p><strong>Lean bool:</strong> If True, character root bone is rotated in opposite direction of ground normal.</p>
</li>
<li>
<p><strong>UphillLean float:</strong> Amount to lean forward when going uphill. Range is 0-1. Default 0.3.</p>
</li>
<li>
<p><strong>DownhillLean float:</strong> Amount to lean backward when going downhill. Range is 0-1. Default 0.5.</p>
</li>
<li>
<p><strong>SidehillLean float:</strong> Amount to lean sideways into side-hills. Range is 0-1. Default 0.0.</p>
</li>
</ul>
<h3 id="counter-leaning">Counter Leaning</h3>
<p>These settings are designed to allow the head of the character to counteract the spine leaning adjustments. This prevents characters from looking straight down when leaning into an up hill, or straight up when leaning back on a downhill.</p>
<ul>
<li>
<p><strong>CounterLean bool:</strong> If True, will counter lean CounterLeanBone. Usually this is the head.</p>
</li>
<li>
<p><strong>CounterLeanBoneName Name:</strong>Name of base of counter lean bone. Usually this is the base Head bone.</p>
</li>
<li>
<p><strong>UphillCounterLean float:</strong> Amount to counter lean backward when going uphill. Range is 0-1. Default 0.8.</p>
</li>
<li>
<p><strong>DownhillCounterLean float:</strong> Amount to counter lean backward when going downhill. Range is 0-1. Default 1.0.</p>
</li>
<li>
<p><strong>SidehillCounterLean float:</strong> Amount to counter lean sideways into side-hills. Range is 0-1. Default 0.0.</p>
</li>
</ul>
<h3 id="root-offset">Root Offset</h3>
<p>These settings let you offset the position of the root bone above the foot effectors. It's useful to be able to push the root forward/back and up and down in reaction to the slope.</p>
<ul>
<li>
<p><strong>MoveRoot bool:</strong> If True, character root bone position is gradually pushed vertically and horizontally.</p>
</li>
<li>
<p><strong>UphillVertOffset float:</strong> Amount (in centimeters) to push the character root up/down when going UP hill. Default 10.0.</p>
</li>
<li>
<p><strong>UphillHorizOffset float:</strong> Amount (in centimeters) to push the character root forward/back when going UP hill. Default -20.0.</p>
</li>
<li>
<p><strong>DownhillVertOffset float:</strong> Amount (in centimeters) to push the character root up/down when going DOWN hill. Default 10.0.</p>
</li>
<li>
<p><strong>DownhillHorizOffset float:</strong> Amount (in centimeters) to push the character root forward/back when going DOWN hill. Default 20.0.</p>
</li>
<li>
<p><strong>SidehillVertOffset float:</strong> Amount (in centimeters) to push the character root up/down when on a SIDE hill. Default -10.0.</p>
</li>
<li>
<p><strong>SidehillHorizOffset float:</strong> Amount (in centimeters) to push the character root forward/back when on a SIDE hill. Default -10.0.</p>
</li>
</ul>
<h3 id="foot-rotation">Foot Rotation</h3>
<p>It is useful to be able to control the rotation of the foot pitch and roll independently. Creatures usually orient the pitch of their foot to the ground, but only slightly roll the foot to the ground.</p>
<ul>
<li>
<p><strong>RotateFootToGround bool:</strong> If True, feet are oriented to ground normal.</p>
</li>
<li>
<p><strong>PitchFootAmount float:</strong> Amount to pitch foot to orient to up/down hills. Range is 0-1. Default 1.0.</p>
</li>
<li>
<p><strong>RollFootAmount float:</strong> Amount to roll foot to orient to sidehills. Range is 0-1. Default 0.6.</p>
</li>
</ul>
<h3 id="foot-offset">Foot Offset</h3>
<p>The Foot Offset feature is useful for nudging feet in the direction of the ground normal so that they come into contact with the ground surface precisely. </p>
<p>By default, Power IK maintains the distance of the foot bone relative to the XY plane. Applying an offset may be necessary if the character was not modeled to stand exactly on this plane in the reference pose.</p>
<ul>
<li><strong>Offset Feet Positions bool:</strong> If True, feet positions are offset in direction of ground normal.</li>
<li><strong>Static Foot Offset float:</strong> Amount in centimeters to push feet in direction of ground normal.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../control_rig/" class="btn btn-neutral float-right" title="Control Rig">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../effector_smoothing/" class="btn btn-neutral" title="Effector Smoothing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../effector_smoothing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../control_rig/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
